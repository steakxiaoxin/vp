<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack小记 | 新</title>
    <meta name="description" content="新的开始">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/vp/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/vp/assets/css/0.styles.9ce246fe.css" as="style"><link rel="preload" href="/vp/assets/js/app.c779af42.js" as="script"><link rel="preload" href="/vp/assets/js/3.d4fbc855.js" as="script"><link rel="preload" href="/vp/assets/js/1.71673537.js" as="script"><link rel="preload" href="/vp/assets/js/20.58194bc2.js" as="script"><link rel="preload" href="/vp/assets/js/10.8c5e27e8.js" as="script"><link rel="prefetch" href="/vp/assets/js/11.6b8af23b.js"><link rel="prefetch" href="/vp/assets/js/12.51831905.js"><link rel="prefetch" href="/vp/assets/js/13.58f940ef.js"><link rel="prefetch" href="/vp/assets/js/14.7c4a9f8c.js"><link rel="prefetch" href="/vp/assets/js/15.32dfe2c6.js"><link rel="prefetch" href="/vp/assets/js/16.6f201ad9.js"><link rel="prefetch" href="/vp/assets/js/17.766b04b0.js"><link rel="prefetch" href="/vp/assets/js/18.d110429c.js"><link rel="prefetch" href="/vp/assets/js/19.0028b0ad.js"><link rel="prefetch" href="/vp/assets/js/21.1c6fed06.js"><link rel="prefetch" href="/vp/assets/js/22.7fbef9e3.js"><link rel="prefetch" href="/vp/assets/js/23.99263ed1.js"><link rel="prefetch" href="/vp/assets/js/24.cb0f3cf8.js"><link rel="prefetch" href="/vp/assets/js/25.6f9da378.js"><link rel="prefetch" href="/vp/assets/js/26.7dd0e462.js"><link rel="prefetch" href="/vp/assets/js/27.23027a98.js"><link rel="prefetch" href="/vp/assets/js/28.1910be15.js"><link rel="prefetch" href="/vp/assets/js/29.52bcd7dc.js"><link rel="prefetch" href="/vp/assets/js/30.7002c909.js"><link rel="prefetch" href="/vp/assets/js/31.3916bbc0.js"><link rel="prefetch" href="/vp/assets/js/32.44e2d758.js"><link rel="prefetch" href="/vp/assets/js/33.4147fc31.js"><link rel="prefetch" href="/vp/assets/js/34.59d91005.js"><link rel="prefetch" href="/vp/assets/js/35.10845ca0.js"><link rel="prefetch" href="/vp/assets/js/36.f2100d6e.js"><link rel="prefetch" href="/vp/assets/js/37.8c93da72.js"><link rel="prefetch" href="/vp/assets/js/38.0b8fc93e.js"><link rel="prefetch" href="/vp/assets/js/39.b84db161.js"><link rel="prefetch" href="/vp/assets/js/4.64d5f7b4.js"><link rel="prefetch" href="/vp/assets/js/40.c9cd6723.js"><link rel="prefetch" href="/vp/assets/js/41.5fe112d3.js"><link rel="prefetch" href="/vp/assets/js/42.563ff0e0.js"><link rel="prefetch" href="/vp/assets/js/5.a5a9a4fe.js"><link rel="prefetch" href="/vp/assets/js/6.320f0574.js"><link rel="prefetch" href="/vp/assets/js/7.0e018979.js"><link rel="prefetch" href="/vp/assets/js/8.113f3cd6.js"><link rel="prefetch" href="/vp/assets/js/9.1fd13588.js">
    <link rel="stylesheet" href="/vp/assets/css/0.styles.9ce246fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-146b4d24><div data-v-146b4d24><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-146b4d24 data-v-146b4d24><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-1e2a0cc0 data-v-146b4d24 data-v-146b4d24><h3 class="title" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0>新</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><input type="password" value="" data-v-1e2a0cc0> <span data-v-1e2a0cc0>Konck! Knock!</span> <button data-v-1e2a0cc0>OK</button></label> <div class="footer" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><span data-v-1e2a0cc0><i class="iconfont reco-theme" data-v-1e2a0cc0></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-1e2a0cc0>vuePress-theme-reco</a></span> <span data-v-1e2a0cc0><i class="iconfont reco-copyright" data-v-1e2a0cc0></i> <a data-v-1e2a0cc0><span data-v-1e2a0cc0>新</span>
            
          <span data-v-1e2a0cc0>2019 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-146b4d24><header class="navbar" data-v-146b4d24><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vp/" class="home-link router-link-active"><!----> <span class="site-name">新</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vp/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vp/categories/blog/" class="nav-link"><i class="iconfont undefined"></i>
  blog
</a></li><li class="dropdown-item"><!----> <a href="/vp/categories/front-end/" class="nav-link"><i class="iconfont undefined"></i>
  front-end
</a></li><li class="dropdown-item"><!----> <a href="/vp/categories/read/" class="nav-link"><i class="iconfont undefined"></i>
  read
</a></li></ul></div></div><div class="nav-item"><a href="/vp/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/vp/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://zwaq.top" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-toutiao"></i>
  老毕
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-146b4d24></div> <aside class="sidebar" data-v-146b4d24><div class="personal-info-wrapper" data-v-b038cec6><!----> <h3 class="name" data-v-b038cec6>
    新
  </h3> <div class="num" data-v-b038cec6><div data-v-b038cec6><h3 data-v-b038cec6>24</h3> <h6 data-v-b038cec6>Article</h6></div> <div data-v-b038cec6><h3 data-v-b038cec6>9</h3> <h6 data-v-b038cec6>Tag</h6></div></div> <hr data-v-b038cec6></div> <nav class="nav-links"><div class="nav-item"><a href="/vp/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vp/categories/blog/" class="nav-link"><i class="iconfont undefined"></i>
  blog
</a></li><li class="dropdown-item"><!----> <a href="/vp/categories/front-end/" class="nav-link"><i class="iconfont undefined"></i>
  front-end
</a></li><li class="dropdown-item"><!----> <a href="/vp/categories/read/" class="nav-link"><i class="iconfont undefined"></i>
  read
</a></li></ul></div></div><div class="nav-item"><a href="/vp/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/vp/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://zwaq.top" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-toutiao"></i>
  老毕
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack小记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#webpack-基础用法" class="sidebar-link">webpack 基础用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_01-配置文件名称" class="sidebar-link">01.配置文件名称</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_02-配置组成" class="sidebar-link">02.配置组成</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_03-基础用法之核心概念" class="sidebar-link">03.基础用法之核心概念</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_04-资源解析" class="sidebar-link">04.资源解析</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_05-文件监听" class="sidebar-link">05.文件监听</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_06-热更新" class="sidebar-link">06.热更新</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_07-文件指纹策略" class="sidebar-link">07.文件指纹策略</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_08-代码压缩" class="sidebar-link">08.代码压缩</a></li></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#webpack-深入用法" class="sidebar-link">webpack 深入用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_01-自动清理构建目录产物" class="sidebar-link">01.自动清理构建目录产物</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_02-移动端-css-px-自动转换成-rem" class="sidebar-link">02. 移动端 CSS px 自动转换成 rem</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_03-静态资源内联" class="sidebar-link">03. 静态资源内联</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_04-多页面应用打包通用方案" class="sidebar-link">04. 多页面应用打包通用方案</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_05-使用-source-map" class="sidebar-link">05. 使用 source map</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_06-提取页面公共资源" class="sidebar-link">06. 提取页面公共资源</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_07-tree-shaking-摇树优化" class="sidebar-link">07. tree shaking(摇树优化)</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_08-scope-hoisting-作用域提升" class="sidebar-link">08. Scope Hoisting(作用域提升)</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_09-代码分割和动态import" class="sidebar-link">09. 代码分割和动态import</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_10-webpack-配合-eslint" class="sidebar-link">10. Webpack 配合 eslint</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_11-webpack-打包库和组件" class="sidebar-link">11. Webpack 打包库和组件</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_12-webpack-实现-ssr-打包" class="sidebar-link">12. webpack 实现 ssr 打包</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_13-优化构建时命令行的显示日志" class="sidebar-link">13.优化构建时命令行的显示日志</a></li><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#_14-构建异常和中断处理" class="sidebar-link">14.构建异常和中断处理</a></li></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#编写可维护的-webpack-构建配置" class="sidebar-link">编写可维护的 webpack 构建配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#git-规范和-changelog-生成" class="sidebar-link">Git 规范和 changelog 生成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#技术方案" class="sidebar-link">技术方案</a></li></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#速度和大小分析" class="sidebar-link">速度和大小分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#多进程多实例构建" class="sidebar-link">多进程多实例构建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#多进程多实例并行压缩" class="sidebar-link">多进程多实例并行压缩</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#利用缓存提升二次构建" class="sidebar-link">利用缓存提升二次构建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#图片压缩" class="sidebar-link">图片压缩</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vp/front-end/20190301webpack%E5%B0%8F%E8%AE%B0/#使用-tree-shaking-擦除无用的css" class="sidebar-link">使用 tree shaking 擦除无用的css</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-1e2a0cc0 data-v-146b4d24><h3 class="title" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0>webpack小记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><input type="password" value="" data-v-1e2a0cc0> <span data-v-1e2a0cc0>Konck! Knock!</span> <button data-v-1e2a0cc0>OK</button></label> <div class="footer" style="display:none;" data-v-1e2a0cc0 data-v-1e2a0cc0><span data-v-1e2a0cc0><i class="iconfont reco-theme" data-v-1e2a0cc0></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-1e2a0cc0>vuePress-theme-reco</a></span> <span data-v-1e2a0cc0><i class="iconfont reco-copyright" data-v-1e2a0cc0></i> <a data-v-1e2a0cc0><span data-v-1e2a0cc0>新</span>
            
          <span data-v-1e2a0cc0>2019 - </span>
          2020
        </a></span></div></div> <div data-v-146b4d24><main class="page"><div class="page-title" style="display:none;"><h1>webpack小记</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>新</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2019-03-01</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      webpack
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="webpack小记"><a href="#webpack小记" class="header-anchor">#</a> webpack小记</h1> <blockquote><p>为什么要使用构建工具?</p> <ul><li>转换 es6 语法</li> <li>转换 jsx</li> <li>css 前缀补全 / 预处理器 (less...)</li> <li>压缩混淆</li> <li>图片压缩等等</li></ul></blockquote> <h2 id="webpack-基础用法"><a href="#webpack-基础用法" class="header-anchor">#</a> webpack 基础用法</h2> <h3 id="_01-配置文件名称"><a href="#_01-配置文件名称" class="header-anchor">#</a> 01.配置文件名称</h3> <p>webpack 默认配置文件：webpack.config.js</p> <p>可以通过 webpack --config 指定配置文件</p> <h3 id="_02-配置组成"><a href="#_02-配置组成" class="header-anchor">#</a> 02.配置组成</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> xx<span class="token punctuation">,</span> <span class="token comment">// 打包的入口文件</span>
  output<span class="token operator">:</span> xx<span class="token punctuation">,</span> <span class="token comment">// 打包的输出</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 环境</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// loader 配置</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 插件配置</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_03-基础用法之核心概念"><a href="#_03-基础用法之核心概念" class="header-anchor">#</a> 03.基础用法之核心概念</h3> <p><strong>entry 用来指定 webpack 的打包入口</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 单入口</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 多入口</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    adminApp<span class="token operator">:</span> <span class="token string">'./src/adminApp.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>output 用来告诉 webpack 如何将编译后的文件输出到磁盘</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 单入口</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 多入口</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    adminApp<span class="token operator">:</span> <span class="token string">'./src/adminApp.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span> <span class="token comment">// 通过占位符确保文件名称的唯一</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>loaders 处理文件</strong></p> <p>webpack 开箱只支持 js 和 json 两种文件类型，对不能解析的文件， 通过 loaders 去支持其他文件类型并且把他们转化成有效的模块，并且可以添加到依赖图中。</p> <p>本身是一个函数，接收源文件作为参数，返回转换的结果。</p> <p>常见的 loaders</p> <table><thead><tr><th>名称</th> <th>描述</th></tr></thead> <tbody><tr><td>babel-loader</td> <td>转换es6、es7等 js 新特性语法</td></tr> <tr><td>style-loader</td> <td>将<code>css-loader</code>打包好的css代码以<code>&lt;style&gt;</code>标签的形式插入到html文件中</td></tr> <tr><td>css-loader</td> <td>支持.css文件的加载和解析</td></tr> <tr><td>less-loader</td> <td>将less文件专化成cssloader</td></tr> <tr><td>ts-loader</td> <td>将ts转换成js</td></tr> <tr><td>file-loader</td> <td>进行图片、字体等的打包</td></tr> <tr><td>raw-loader</td> <td>将文件以字符串的形式导入</td></tr> <tr><td>thread-loader</td> <td>多进程打包js和css</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/.(js|jsx)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>plugins 插件用于 bundle 文件的优化，资源管理和环境变量注入，作用域整个构建过程</strong></p> <table><thead><tr><th>名称</th> <th>描述</th></tr></thead> <tbody><tr><td>CommonChunkPlugin</td> <td>将chunks相同的模块代码提取成公共js，适用于多页面打包</td></tr> <tr><td>CleanWebpackPlugin</td> <td>清理构建目录</td></tr> <tr><td>ExtractTextWebpackPlugin</td> <td>将css从bundle文件里提取一个独立的css文件</td></tr> <tr><td>CopyWebpackPlugin</td> <td>将文件或者文件夹拷贝到构建的输出目录</td></tr> <tr><td>HtmlWebpackPlugin</td> <td>创建 html 文件去承载输出的 bundle, 能使用ejs语法</td></tr> <tr><td>UglifyjsWebpackPlugin</td> <td>压缩 js</td></tr> <tr><td>ZipWebpackPlugin</td> <td>将打包出的资源生成一个zip包</td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/index.html&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>mode 用来指定当前的构建环境</strong></p> <p>默认为 production</p> <p>内置函数功能</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>development</td> <td>设置 process.env.NODE_ENV 的值为 <code>development</code> 开启 <code>NamedChunksPlugin</code> 和 <code>NamedModulesPlugin</code> （代码热更新 HMR 提示)</td></tr> <tr><td>production</td> <td>设置 process.env.NODE_ENV 的值为 <code>production</code> 开启 FlagDependencyUsagePlugin，FlagIncludedChunksPlugin，ModuleConcatenationPlugin，NoEmitOnErrorsPlugin，OccurrenceOrderPlugin，SideEffectsFlagPlugin，TerserPlugin</td></tr> <tr><td>none</td> <td>不开启任何优化选项</td></tr></tbody></table> <p><strong>webpack打包过程</strong></p> <p>webpack启动后会从 Entry 里配置的 Module 开始递归解析 Entry 依赖的所有Module.每找到一个Module,就会根据配置的Loader去找出对应的转换规则，对Module进行转换后，再解析出当前的Module依赖的Module.这些模块会以Entry为单位进行分组，一个Entry和其所有依赖的Module被分到一个组也就是一个Chunk。最好Webpack会把所有Chunk转换成文件输出。在整个流程中Webpack会在恰当的时机执行Plugin里定义的逻辑</p> <h3 id="_04-资源解析"><a href="#_04-资源解析" class="header-anchor">#</a> 04.资源解析</h3> <p><strong>解析 es6</strong></p> <ol><li>使用 babel-loader</li> <li>配置 .babelrc</li></ol> <p><code>npm i -D @babel/core @babel/preset-env babel-loader</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(js|jsx)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">{</span> loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><a href="https://pdsuwwz.github.io/2018/09/29/webpack4-babel7/" target="_blank" rel="noopener noreferrer">babel7升级采坑<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>解析 react jsx</strong></p> <p><code>npm i -D @babel/preset-react</code></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>解析 css</strong></p> <p><code>npm i -D style-loader css-loader</code></p> <ul><li><p>css-loader 用于加载 .css 文件，并且转换成 commonjs 对象</p></li> <li><p>style-loader 将样式通过 <code>&lt;style&gt;</code> 标签插入到 head 中</p></li> <li><p>postcss-loader 添加厂商前缀, 使用 autoprefixer 插件 (后置处理器: 代码生成后再进行处理, can i use)</p> <p><code>npm i -D postcss-loader autoprefixer</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 添加 postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;autoprefixer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      browsers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;last 2 version&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&gt;1%&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ios 7&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 多 loader 执行从右往左, 从下到上</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(css)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>解析 less</strong></p> <p><code>npm i -D less less-loader</code></p> <ul><li>less-loader 用于将 less 转换成 css</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 多 loader 执行从右往左</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(less)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>解析图片和字体</strong></p> <p><code>npm i -D file-loader url-loader</code></p> <ul><li>file-loader 用于处理文件</li> <li>url-loaer 处理图片和字体，可以设置较小资源自动 base64</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(bmp|gif|jpeg|jpg|png|svg)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(eot|woff|ttf|woff2|otf)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(bmp|gif|jpeg|jpg|png|svg)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>
    	<span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">10240</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span> 
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(eot|woff|ttf|woff2|otf)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>
    	<span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span> limit<span class="token operator">:</span> <span class="token number">10240</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span> 
	  <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>注意：如果使用 url-loader 不配置 limit (字节)。虽然图片被打包进js里面，加载好js 图片自然就出来，它不用再去额外请求一个图片的地址了，省了一次http请求，但是带来的问题是什么呢？如果这个文件特别大，打包生成的js也会特别的大，那么你加载这个js的时间就会很长，那么url-loader的最佳使用方式是什么？如果图片非常小只有1-2kb，那么图片被打包进js文件是个非常好的选择，如果图片很大，那就应该像file-loader一样，把图片打包到dist目录下，不要打包到bundle.js里</p> <h3 id="_05-文件监听"><a href="#_05-文件监听" class="header-anchor">#</a> 05.文件监听</h3> <p>文件监听是在发现源码发生变化时，自动重新构建出新的输出文件，缺点是每次都需要手动刷新浏览器</p> <p><strong>开启方式</strong></p> <ul><li>启动 webpack 命令时，带上 --watch 参数</li> <li>在配置 webpack.config.js 中设置 watch: true</li></ul> <p><strong>原理分析</strong></p> <p>轮询判断文件的最后编辑时间是否变化</p> <p>某个文件发生了变化，并不会立即告诉监听者，而是先缓存起来，等 aggregateTimeout</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 默认 false，</span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 开启监听模式后，watchOptions才有意义</span>
  watchOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 默认为空，不监听的文件或文件夹，支持正则</span>
    ignored<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
    <span class="token comment">// 监听到变化发生后会等300ms再去执行，默认300ms</span>
    aggregateTimeout<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token comment">// 判断文件是否发生变化是通过不停轮询系统指定文件有没有变化实现的，默认每秒问1000次</span>
    poll<span class="token operator">:</span> <span class="token number">1000</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_06-热更新"><a href="#_06-热更新" class="header-anchor">#</a> 06.热更新</h3> <p><strong>使用热更新</strong></p> <ol><li><p>webpack-dev-server</p> <p>WDS 不刷新浏览器，不输出文件，而是放在内存中</p> <p>添加 devServer 配合 <code>webpack.HotModuleReplacementPlugin</code> 插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>webpack-dev-middleware</p> <p>WDM 将 webpack 输出的文件传输给服务器，适用于灵活的定制场景</p></li></ol> <p><strong>热更新的原理分析?</strong> 见19节</p> <h3 id="_07-文件指纹策略"><a href="#_07-文件指纹策略" class="header-anchor">#</a> 07.文件指纹策略</h3> <ol><li><p>什么是文件指纹？</p> <p>打包后输出的文件名的后缀，通常用来作为版本的管理</p></li> <li><p>文件指纹如何生成？</p> <p><strong>hash</strong>：和整个项目的构建相关，只要项目文件有修改，整个项目构建的hash值就会更改</p> <p><strong>chunkhash</strong>：和 webpack 打包的 chunk 有关，不同的 entry 会生成不同的 chunkhush 值</p> <p><strong>contenthash</strong>：根据文件内容来定义 hash，文件内容不变，则 contenthash 不变 (常用于css文件)</p></li> <li><p>js 文件指纹设置</p> <p>设置 output 的 filename，使用 [chunkhash]</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name]_[chunkhash:8].js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>css 文件指纹设置</p> <p><code>npm i -D mini-css-extract-plugin</code></p> <p>设置 MiniCssExtractPlugin 的 filename，使用 [contenthash]</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(css)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(less)$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;[name]_[contenthash:8].css&quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p>图片文件指纹设置</p> <p>设置 file-loader 的 name，使用 [hash]</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(bmp|gif|jpeg|jpg|png|svg)$/</span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              name<span class="token operator">:</span> <span class="token string">'img/[name]_[hash:8].[ext]'</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
	  <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ol> <table><thead><tr><th>占位符名称</th> <th>含义</th></tr></thead> <tbody><tr><td>[ext]</td> <td>资源后缀名</td></tr> <tr><td>[name]</td> <td>文件名称</td></tr> <tr><td>[path]</td> <td>文件的相对路径</td></tr> <tr><td>[folder]</td> <td>文件所在文件夹</td></tr> <tr><td>[contenthash]</td> <td>文件的内容hash，默认是md5生成</td></tr> <tr><td>[hash]</td> <td>文件内容的hash，默认是md5生成</td></tr> <tr><td>[emoji]</td> <td>一个随机的纸袋文件内容的emoji</td></tr></tbody></table> <h3 id="_08-代码压缩"><a href="#_08-代码压缩" class="header-anchor">#</a> 08.代码压缩</h3> <ol><li><p>js 压缩</p> <p>内置了 uglifyjs-webpack-plugin，也可手动安装添加额外参数例如并行压缩</p></li> <li><p>css 压缩</p> <p>使用 optimize-css-assets-webpack-plugin 和 cssnano</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      assetNameRegExp<span class="token operator">:</span> <span class="token regex">/\.css/g</span><span class="token punctuation">,</span>
      cssProcessor<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>html 压缩</p> <p>使用 html-webpack-plugin，设置压缩参数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 引入的 js 模块</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span>
      inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">'ejs title'</span><span class="token punctuation">,</span> <span class="token comment">// 在 HTML 中用 ejs 语法 &lt;%= htmlWebpackPlugin.options.title %&gt; 生效</span>
      minify<span class="token operator">:</span> <span class="token punctuation">{</span>
        html5<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        preserveLineBreaks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 去掉注释</span>
        removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 去掉引号</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li></ol> <h2 id="webpack-深入用法"><a href="#webpack-深入用法" class="header-anchor">#</a> webpack 深入用法</h2> <h3 id="_01-自动清理构建目录产物"><a href="#_01-自动清理构建目录产物" class="header-anchor">#</a> 01.自动清理构建目录产物</h3> <p>每次构建的时候不会清理目录，造成构建的输出目录 output 文件越来越多</p> <p>解决方法</p> <ol><li><p>通过 npm script 清理构建目录</p> <ul><li><code>rm -rf ./dist &amp;&amp; webpack</code></li> <li><code>rimraf ./dist &amp;&amp; webpack</code> 使用 npm 库解决不同端的命令</li></ul></li> <li><p>使用 clean-webpack-plugin 插件</p> <p>默认会删除 output 指定的输出目录</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 注意 clean-webpack-plugin v3.0.0 使用解构方法引入</span>
<span class="token comment">// v2.0.2 直接引入即可 const CleanWebpackPlugin = require('clean-webpack-plugin');</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol> <h3 id="_02-移动端-css-px-自动转换成-rem"><a href="#_02-移动端-css-px-自动转换成-rem" class="header-anchor">#</a> 02. 移动端 CSS px 自动转换成 rem</h3> <p>W3C 对 rem 的定义：font-size of the root element</p> <p>rem 和 px 的对比：</p> <ul><li>rem 是相对单位</li> <li>px 是绝对单位</li></ul> <p><code>npm i -D px2rem-loader</code></p> <p><code>npm i lib-flexible</code> 页面渲染时计算根元素的 font-size 值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(css)$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(less)$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;px2rem-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              remUnit<span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token comment">// rem 相对于 px 的转换单位 1rem=75px</span>
              remPrecision<span class="token operator">:</span> <span class="token number">8</span> <span class="token comment">// px 转换为 rem 后小数点位数</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_03-静态资源内联"><a href="#_03-静态资源内联" class="header-anchor">#</a> 03. 静态资源内联</h3> <p><strong>资源内联的意义</strong></p> <p><strong>代码层面</strong>：</p> <ul><li>页面框架的初始化脚本</li> <li>上报相关打点</li> <li>css 内联避免页面闪动</li></ul> <p>请求层面：减少 HTTP 网络请求数</p> <ul><li>小图片或者字体内联 (url-loader)</li></ul> <p><code>npm i -D raw-loader</code></p> <p>raw-loader</p> <ul><li>内联 html <code>${ require('raw-loader!./meta.html') }</code></li> <li>内联 js <code>&lt;script&gt;${ require('raw-loader!babel-loader!../node_modules/lib-flexible/flexible.js') }&lt;/script&gt;</code></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    ${ require('raw-loader!./meta.html') }
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>&lt;%= htmlWebpackPlugin.options.config.title %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      $<span class="token punctuation">{</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raw-loader!babel-loader!../node_modules/lib-flexible/flexible.js'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 六一节快乐 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_04-多页面应用打包通用方案"><a href="#_04-多页面应用打包通用方案" class="header-anchor">#</a> 04. 多页面应用打包通用方案</h3> <p><em>(/</em> 生成的多个HTML怎么部署生成环境呢？ <em>/)</em></p> <p><strong>多页面应用 (MPA) 概念</strong></p> <p>每一次页面跳转的时候，后台服务器都会给返回一个新的 html 文档，这种类型的网站也就是多页网站，也叫多页应用。优点：1. 每个页面是解耦的；2. 对SEO更加友好</p> <p><strong>多页面打包基本思路：</strong></p> <p>每个页面对应一个entry，一个 html-webpack-plugin</p> <p>缺点：每次新增或删除页面需要改webpack 配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
        search<span class="token operator">:</span> <span class="token string">'./src/search.js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>多页面打包通用方案：</strong></p> <p>动态获取 entry 和 设置 html-webpack-plugin 数量</p> <p>利用 glob.sync</p> <p><code>entry: glob.sync(path.join(__dirname, './src/*/index.js'))</code></p> <p>entryFile.match(/src(.*)/index.js/)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">setMPA</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> htmlWebpackPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> entryFiles <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/*/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  entryFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> match <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/src\/(.*)\/index\.js/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> pageName <span class="token operator">=</span> match <span class="token operator">&amp;&amp;</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    entry<span class="token punctuation">[</span>pageName<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
    htmlWebpackPlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        config<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> pageName
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span>pageName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 此处引用相应的js模块</span>
        template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../src/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> `$<span class="token punctuation">{</span>pageName<span class="token punctuation">}</span><span class="token punctuation">.</span>html`<span class="token punctuation">,</span>
        title<span class="token operator">:</span> `$<span class="token punctuation">{</span>pageName<span class="token punctuation">}</span> title`<span class="token punctuation">,</span>
        inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        minify<span class="token operator">:</span> <span class="token punctuation">{</span>
          html5<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          preserveLineBreaks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          removeComments<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">,</span>
    htmlWebpackPlugins
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> entry<span class="token punctuation">,</span> htmlWebpackPlugins <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">setMPA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>htmlWebpackPlugins<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="_05-使用-source-map"><a href="#_05-使用-source-map" class="header-anchor">#</a> 05. 使用 source map</h3> <p>作用：通过 source map 定位到源代码</p> <p>开发环境开启，线上环境关闭( 线上排查问题的时候可以将 sourcemap 上传到错误监控系统 )</p> <p><strong>source map 关键字</strong></p> <ul><li>eval：使用 eval 包裹模块代码</li> <li>source map：产生 .map 文件</li> <li>cheap：不包含列信息</li> <li>inline：将 .map 作为 DataURL 嵌入，不单独生成 .map 文件</li> <li>module：包含loader 的 source map</li></ul> <p><strong>source map 类型</strong></p> <table><thead><tr><th>devtool</th> <th>首次构建速度</th> <th>二次构建速度</th> <th>是否适合prod</th> <th>可以定位的代码</th></tr></thead> <tbody><tr><td>(none)</td> <td>+++</td> <td>+++</td> <td>y</td> <td>最终输出的代码</td></tr> <tr><td>eval</td> <td>+++</td> <td>+++</td> <td>n</td> <td>webpack生成的代码(一个个的模块)</td></tr> <tr><td>cheap-eval-source-map</td> <td>+</td> <td>++</td> <td>n</td> <td>经过loader转换后的代码(只能看到行)</td></tr> <tr><td>cheap-module-source-map</td> <td>0</td> <td>++</td> <td>n</td> <td>源代码(只能看到行)</td></tr> <tr><td>eval-source-map</td> <td>--</td> <td>+</td> <td>n</td> <td>源代码</td></tr> <tr><td>cheap-source-map</td> <td>+</td> <td>0</td> <td>y</td> <td>经过loader转换后的代码(只能看到行)</td></tr> <tr><td>cheap-module-source-map</td> <td>0</td> <td>-</td> <td>y</td> <td>源代码(只能看到行)</td></tr> <tr><td>inline-cheap-source-map</td> <td>+</td> <td>0</td> <td>n</td> <td>经过loader转换后的代码(只能看到行)</td></tr> <tr><td>inline-cheap-module-source-map</td> <td>0</td> <td>-</td> <td>n</td> <td>源代码(只能看到行)</td></tr> <tr><td>source-map</td> <td>--</td> <td>--</td> <td>y</td> <td>源代码</td></tr> <tr><td>inline-source-map</td> <td>--</td> <td>--</td> <td>n</td> <td>源代码</td></tr> <tr><td>hidden-source-map</td> <td>--</td> <td>--</td> <td>y</td> <td>源代码</td></tr></tbody></table> <p><code>+++</code> 非常快速, <code>++</code> 快速, <code>+</code> 比较快, <code>o</code> 中等, <code>-</code> 比较慢, <code>--</code> 慢</p> <ul><li>开发环境：  <code>devtool: &quot;cheap-module-eval-source-map&quot;,</code></li> <li>生产环境：null</li></ul> <h3 id="_06-提取页面公共资源"><a href="#_06-提取页面公共资源" class="header-anchor">#</a> 06. 提取页面公共资源</h3> <p><strong>基础库分离</strong> 提取后可用浏览器缓存减少请求</p> <p>思路：将 react、react-dom 基础包通过 cdn 引入，不打入 bundle 中</p> <ul><li><p>方法一：使用 html-webpack-externals-plugin</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// npm i -D html-webpack-externals-plugin</span>
<span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-externals-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      externals<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          module<span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span>
          entry<span class="token operator">:</span> <span class="token string">&quot;https://unpkg.com/react@16.8.6/umd/react.production.min.js&quot;</span><span class="token punctuation">,</span>
          global<span class="token operator">:</span> <span class="token string">&quot;React&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          module<span class="token operator">:</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span>
          entry<span class="token operator">:</span>
            <span class="token string">&quot;https://unpkg.com/react-dom@16.8.6/umd/react-dom.production.min.js&quot;</span><span class="token punctuation">,</span>
          global<span class="token operator">:</span> <span class="token string">&quot;ReactDOM&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- html 中引入 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/react@16.8.6/umd/react.production.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/react-dom@16.8.6/umd/react-dom.production.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>方法二：利用 SplitChunksPlugin 进行公共脚本分离( webpack4 内置的，替代 CommonsChunkPlugin )</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 抽离 react react-dom 等第三方库</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vendors&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;commons&quot;</span><span class="token punctuation">,</span> pageName<span class="token punctuation">]</span> <span class="token comment">// 添加 vendors, commons</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      minSize<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 抽离的公共包最小的大小(字节)</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/(react|react-dom)/</span><span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'vendors'</span><span class="token punctuation">,</span>
          chunks<span class="token operator">:</span> <span class="token string">'all'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
		commons<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">&quot;commons&quot;</span><span class="token punctuation">,</span>
          chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 官方例子</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 对异步or同步引入的进行分离，all 所有引入的库进行分离(推荐)</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 抽离的公共包最小的大小(字节)</span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 某一方法最小的引用的次数</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 浏览器最大同时请求的数量</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex">/[\\/]node_modules[\\/]/</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li></ul> <h3 id="_07-tree-shaking-摇树优化"><a href="#_07-tree-shaking-摇树优化" class="header-anchor">#</a> 07. tree shaking(摇树优化)</h3> <p>**概念：**1个模块可能有多个方法，只要其中的某个方法使用到了，则整个文件都会被打到 bundle 里面去，tree shaking 就是只把用到的方法打入 bundle，没用到的方法会在 uglify 阶段被擦除掉</p> <p>**使用：**webpack4 默认支持，production mode 默认开启</p> <p>**要求：**必须是 ES6 的语法，CJS 的方式不支持</p> <p><strong>原理：</strong></p> <ul><li><p>DEC (dead code elimination)</p> <ul><li>代码不会被执行，不可到达</li> <li>代码执行的结果不会被用到</li> <li>代码只会影响死变量( 只写不读)</li></ul></li> <li><p>利用 es6 模块的特性：</p> <ul><li>只能作为模块顶层的语句出现</li> <li>import 的模块名只能是字符串常量</li> <li>import binding 是 immutable的</li></ul></li> <li><p>代码擦除：uglify 阶段删除无用代码</p></li></ul> <h3 id="_08-scope-hoisting-作用域提升"><a href="#_08-scope-hoisting-作用域提升" class="header-anchor">#</a> 08. Scope Hoisting(作用域提升)</h3> <p>**现象：**构建后的代码存在大量闭包代码</p> <p>**使用：**webpack4 默认支持，production mode 默认开启</p> <p>**要求：**必须是 ES6 的语法，CJS 的方式不支持</p> <p><strong>原理：</strong> 分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。 因此只有那些被引用了一次的模块才能被合并。</p> <p><strong>好处：</strong></p> <ul><li>代码体积更小，因为函数申明语句会产生大量代码；</li> <li>代码在运行时因为创建的函数作用域更少了，内存开销也随之变小。</li></ul> <h3 id="_09-代码分割和动态import"><a href="#_09-代码分割和动态import" class="header-anchor">#</a> 09. 代码分割和动态import</h3> <p><strong>代码分割的意义</strong>：对于大的 web 应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些代码块是在某些特殊的时候才会被使用到。webpack 有一个功能就是将你的代码库分割成 chunks (语块)，当代码运行到需要它们的时候再进行加载。</p> <p><strong>使用的场景</strong>：抽离相同代码到一个共享块；脚本懒加载，使得初始下载的代码更小</p> <p><strong>懒加载 js 脚本的方式</strong>：</p> <ul><li>CommonJS：require.ensure</li> <li>Es6：动态 import (目前还没有原生支持，需要 babel 转换)</li></ul> <p><strong>动态 import</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// npm i -D @babel/plugin-syntax-dynamic-import</span>
<span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// testImport.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>动态 <span class="token keyword">import</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// index.js</span>
<span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      Text<span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./testImport&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">Text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Text<span class="token operator">:</span> Text<span class="token punctuation">.</span>default <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> Text <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadComponent</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>点击我动态加载<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>Text <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Text <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_10-webpack-配合-eslint"><a href="#_10-webpack-配合-eslint" class="header-anchor">#</a> 10. Webpack 配合 eslint</h3> <ul><li>Airbnb：eslint-config-airbnb、eslint-config-airbnb-base</li></ul> <h3 id="_11-webpack-打包库和组件"><a href="#_11-webpack-打包库和组件" class="header-anchor">#</a> 11. Webpack 打包库和组件</h3> <p>webpack 除了可以打包应用，也可以用来打包 js 库，支持 ES module，CJS，AMD</p> <p>library：指定库的全局变量</p> <p>libraryTarget：指定库的引入方式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /src/index.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> a<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> j <span class="token operator">=</span> b<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> carry <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">||</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> sum<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      x <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
      i<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      y <span class="token operator">=</span> b<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
      j<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    sum <span class="token operator">=</span> x <span class="token operator">+</span> y <span class="token operator">+</span> carry<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      carry <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      sum <span class="token operator">-=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      carry <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 第一次 0 + ''</span>
    ret <span class="token operator">=</span> sum <span class="token operator">+</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>carry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret <span class="token operator">=</span> carry <span class="token operator">+</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./dist/large-number.min.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./dist/large-number.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// /package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;large-number-add&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Large integer addition&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prepublish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xiaoxin&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;terser-webpack-plugin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.3.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.35.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.5&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// /webpack.config.js</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;large-number&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;large-number.min&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">&quot;largeNumber&quot;</span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
    libraryExport<span class="token operator">:</span> <span class="token string">&quot;default&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        include<span class="token operator">:</span> <span class="token regex">/\.min\.js$/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>npm</strong></p> <ul><li>发布 npm publish</li> <li>更新 npm version patch
<ul><li>patch：小变动，比如修复bug等，版本号变动 <strong>v1.0.0-&gt;v1.0.1</strong></li> <li>minor：增加新功能，不影响现有功能,版本号变动 <strong>v1.0.0-&gt;v1.1.0</strong></li> <li>major：破坏模块对向后的兼容性，版本号变动 <strong>v1.0.0-&gt;v2.0.0</strong></li></ul></li> <li>弃用 npx force-unpublish large-number-1st 'test delete'</li> <li>删除 npm unpublish large-number-1st --force</li></ul> <h3 id="_12-webpack-实现-ssr-打包"><a href="#_12-webpack-实现-ssr-打包" class="header-anchor">#</a> 12. webpack 实现 ssr 打包</h3> <p>34 ~ 35</p> <h3 id="_13-优化构建时命令行的显示日志"><a href="#_13-优化构建时命令行的显示日志" class="header-anchor">#</a> 13.优化构建时命令行的显示日志</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> FriendlyErrorsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  stats<span class="token operator">:</span> <span class="token string">&quot;errors-only&quot;</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span><span class="token punctuation">,</span>
    stats<span class="token operator">:</span> <span class="token string">&quot;errors-only&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_14-构建异常和中断处理"><a href="#_14-构建异常和中断处理" class="header-anchor">#</a> 14.构建异常和中断处理</h3> <p>如何判断构建是否成功？</p> <p>在 CI/CD 的 pipline 或者发布系统需要知道当前构建状态</p> <p>每次构建完成后输入 <code>echo $?</code> 获取错误码</p> <p>Node.js 中 process.exit 规范</p> <ul><li>0 表示成功完成</li> <li>非 0 表示失败</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">,</span> <span class="token parameter">stats</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors <span class="token operator">&amp;&amp;</span>
          stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
          process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;--watch&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;build error!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可在命令行输入 <code>echo $?</code> 拿到 errno 为 1 进而进行上报错误日志等操作</p> <h2 id="编写可维护的-webpack-构建配置"><a href="#编写可维护的-webpack-构建配置" class="header-anchor">#</a> 编写可维护的 webpack 构建配置</h2> <p><strong>构建配置抽离成 npm 包的意义</strong></p> <p>通用性</p> <ul><li>业务开发者无需关注构建配置</li> <li>统一团队构建脚本</li></ul> <p>可维护性</p> <ul><li>构建配置合理的拆分</li> <li>README 文档、changeLog 文档等</li></ul> <p>质量</p> <ul><li>冒烟测试、单元测试、测试覆盖率</li> <li>持续集成</li></ul> <p><strong>构建配置管理的可选方案</strong></p> <ul><li>通过多个配置文件管理不同环境的构建，webpack --config 参数进行控制</li> <li>将构建配置设计成一个库，比如：hjs-webpack、neutrino、webpack-blocks</li> <li>抽成一个工具进行管理，比如：create-react-app，kyt，nwb</li> <li>将所有的配置放在一个文件，通过 --env 参数控制分支选择</li></ul> <h2 id="git-规范和-changelog-生成"><a href="#git-规范和-changelog-生成" class="header-anchor">#</a> Git 规范和 changelog 生成</h2> <blockquote><p>良好的 git commit 规范优势：</p> <ul><li>加快 code review 的流程</li> <li>根据 git commit 的元数据生成 changelog</li> <li>后续维护者可以知道 feature 被修改的原因</li></ul></blockquote> <h3 id="技术方案"><a href="#技术方案" class="header-anchor">#</a> 技术方案</h3> <p><strong>Git提交格式</strong></p> <ol><li>统一团队Git commit 日志标准，便于后续代码review和版本发布</li> <li>使用angular的git commit 日志作为基本规范
<ul><li>提交类型限制为：feat, fix, docs, style, refactor, perf, test, chore, revert等</li> <li>提交信息分为两部分，标题(首字母不大写，末尾不要标点)、主题内容(正常的描述信息即可)</li></ul></li> <li>日志提交时友好的类型选择提示 --- 使用commitize 工具</li> <li>不符合要求格式的日志拒绝提交的保障机制
<ul><li>使用validate-commit-msg 工具</li> <li>需要同时在客户端、gitlab server hook做</li></ul></li> <li>统一 changelog 文档信息生成 --- 使用conventional-changelog-cli 工具</li></ol> <p><strong>格式要求</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;
&lt;BLANK LINE&gt;
&lt;body&gt;
&lt;BLANK LINE&gt;
&lt;footer&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对格式的说明如下：</p> <ul><li>type代表某次提交的类型，比如是修复一个bug还是增加一个新的feature。所有的type类型如下：</li> <li>feat：新增feature</li> <li>fix：修复bug</li> <li>docs：仅仅修改了文档，比如README, CHANGELOG等</li> <li>style：仅仅修改了空格，格式缩进，不改变代码逻辑</li> <li>refactor：代码重构，没有加新功能或者修复bug</li> <li>perf：优化相关，比如提升性能，体验</li> <li>test：测试用例，包括单元测试，集成测试等</li> <li>chore：改变构建流程、或者增加依赖库、工具等</li> <li>revert：回滚到上一个版本</li></ul> <p><strong>本地开发阶段配置</strong></p> <p>安装依赖</p> <p><code>npm i @commitlint/cli @commitlint/config-conventional commitizen cz-conventional-changelog husky -D</code></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git add -A &amp;&amp; git-cz&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./node_modules/cz-conventional-changelog&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;commit-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commitlint -E HUSKY_GIT_PARAMS&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@commitlint/cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@commitlint/config-conventional&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.1.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;cz-conventional-changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>如果最后产生一个这样的错误：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Error: Could not resolve /Users/Elite/web/node_modules/cz-conventional-changelog. 
Cannot <span class="token function">find</span> module <span class="token string">'/Users/Elite/web/node_modules/cz-conventional-changelog'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>只需做个软连接即可：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">ln</span> -s /Users/Elite/node_modules /Users/Elite/web/node_modules
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者改变 package.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;commitizen&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./web/Public/static/node_modules/cz-conventional-changelog&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="速度和大小分析"><a href="#速度和大小分析" class="header-anchor">#</a> 速度和大小分析</h2> <p>使用 speed-measure-webpack-plugin 和 webpack-bundle-analyzer</p> <p><code>npm i -D speed-measure-webpack-plugin webpack-bundle-analyzer</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>exportObj<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="多进程多实例构建"><a href="#多进程多实例构建" class="header-anchor">#</a> 多进程多实例构建</h2> <h2 id="多进程多实例并行压缩"><a href="#多进程多实例并行压缩" class="header-anchor">#</a> 多进程多实例并行压缩</h2> <p><code>npm i -D terser-webpack-plugin</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        parallel<span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="利用缓存提升二次构建"><a href="#利用缓存提升二次构建" class="header-anchor">#</a> 利用缓存提升二次构建</h2> <p><code>npm i -D terser-webpack-plugin hard-source-webpack-plugin</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span>

loaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory=true'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            parallel<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            cache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="图片压缩"><a href="#图片压缩" class="header-anchor">#</a> 图片压缩</h2> <p><code>npm i -D image-webpack-loader</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex">/\.(gif|png|jpe?g|svg)$/i</span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span>
          progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          quality<span class="token operator">:</span> <span class="token number">65</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// optipng.enabled: false will disable optipng</span>
        optipng<span class="token operator">:</span> <span class="token punctuation">{</span>
          enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        pngquant<span class="token operator">:</span> <span class="token punctuation">{</span>
          quality<span class="token operator">:</span> <span class="token string">'65-90'</span><span class="token punctuation">,</span>
          speed<span class="token operator">:</span> <span class="token number">4</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span>
          interlaced<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// the webp option will enable WEBP</span>
        webp<span class="token operator">:</span> <span class="token punctuation">{</span>
          quality<span class="token operator">:</span> <span class="token number">75</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="使用-tree-shaking-擦除无用的css"><a href="#使用-tree-shaking-擦除无用的css" class="header-anchor">#</a> 使用 tree shaking 擦除无用的css</h2> <p><code>npm i -D purgecss-webpack-plugin</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> PurgecssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span>

		<span class="token keyword">new</span> <span class="token class-name">PurgecssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      paths<span class="token operator">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATHS</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>  <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><br> <section style="border-top:2px solid #eaecef;padding-top:1rem;margin-top:2rem;"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><em class="post-meta-item-text">阅读量： </em> <i class="leancloud-visitors-count"></i></span></div> <h3><a href="javascript:;"></a>
    评 论：
  </h3> <div id="vcomments"></div></section></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/21/2020, 4:11:24 AM</span></div></footer> <!----></main> <!----> <div style="display:none;" data-v-146b4d24 data-v-146b4d24><div class="comments-wrapper" data-v-146b4d24><!----></div></div></div></div></div></div></div><div class="global-ui"><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 新
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="position:fixed;right:150px;bottom:70px;opacity:0.8;z-index:99999;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><div id="goTop" class="hide-cat" data-v-3cd57a9e></div><canvas id="vuepress-canvas-ribbon"></canvas></div></div>
    <script src="/vp/assets/js/app.c779af42.js" defer></script><script src="/vp/assets/js/3.d4fbc855.js" defer></script><script src="/vp/assets/js/1.71673537.js" defer></script><script src="/vp/assets/js/20.58194bc2.js" defer></script><script src="/vp/assets/js/10.8c5e27e8.js" defer></script>
  </body>
</html>
